{% extends 'base.html' %}
{% load static %}

{% block javascript-head %}{% endblock %}

{% block content %}
    <div class="detail-image" style="background-image:url(/{{ object.main_image }});">
        <v-container class="detail-container">
            <v-layout align-end justify-center row wrap fill-height>
                <v-flex xs12 sm12 md12 class="detail-title">
                    <h2 class="display-1">{{ object.airport.name_ja }}</h2>
                    <h3 class="display-1">{{ object.airline.name_ja }}</h3>
                    {{ request.path|slice:'-2:-1' }}
                </v-flex>
            </v-layout>
        </v-container>
    </div>
    <v-layout justify-center row wrap fill-height>

        <v-flex xs12 sm12 md12 class="">

            <v-container>
                <v-layout align-center justify-space-between row wrap fill-height>
                    <v-flex xs12 sm12 md4 class="detail-rate-circle">
                        <p class="detail-rate-circle-total">総合</p>
                        <div class="circle"><strong></strong></div>
                        <div class="detail-rate-review-count"><span class="detail-rate-review-count-num"></span> レビュー</div>
                        <div>
                            {% if user.is_authenticated %}
                                <v-btn color="error m-b-10" dark large href="{% url 'review_new' lounge.id user.pid.hex %}">レビューを書く</v-btn>
                            {% else %}
                                <v-btn color="error m-b-10" dark large href="{% url 'login' %}">レビューを書く</v-btn>
                            {% endif %}
                        </div>
                    </v-flex>
                    <v-flex xs12 sm12 md8 class="">
                        <div class="skillbar" data-percent="5.0">
                            <span class="skillbar-title" style="background:#00C853;">清潔さ</span>
                            <p class="skillbar-bar" style="background:#69F0AE;"></p>
                            <span class="skill-bar-percent"></span>
                        </div>

                        <div class="skillbar" data-percent="8.2">
                            <span class="skillbar-title" style="background:#00C853;">設備</span>
                            <p class="skillbar-bar" style="background:#69F0AE;"></p>
                            <span class="skill-bar-percent"></span>
                        </div>

                        <div class="skillbar" data-percent="10.0">
                            <span class="skillbar-title" style="background:#00C853;">食事</span>
                            <p class="skillbar-bar" style="background:#69F0AE;"></p>
                            <span class="skill-bar-percent"></span>
                        </div>

                        <div class="skillbar" data-percent="2.5">
                            <span class="skillbar-title" style="background:#00C853;">サービス</span>
                            <p class="skillbar-bar" style="background:#69F0AE;"></p>
                            <span class="skill-bar-percent"></span>
                        </div>

                        <div class="skillbar" data-percent="1.0">
                            <span class="skillbar-title" style="background:#00C853;">アクセス</span>
                            <p class="skillbar-bar" style="background:#69F0AE;"></p>
                            <span class="skill-bar-percent"></span>
                        </div>
                    </v-flex>
                </v-layout>

                <v-layout align-space-around justify-space-around row wrap fill-height class="detail-sort">
                    <v-flex xs12 sm4 md4 class="detail-sort-segment">
                        <h5 class="subheading font-weight-bold">評価</h5>
                        <v-layout justify-start column>
                            <v-layout align-start justify-space-between row>
                                <v-checkbox
                                    label="5.0"
                                    color="red"
                                    value="red"
                                    hide-details
                                    class="m-t-0 p-t-0"
                                ></v-checkbox>
                                <v-progress-linear
                                    color="success"
                                    height="15"
                                    value="100"
                                    class="detail-sort-bar"
                                ></v-progress-linear>
                                <div>(30)</div>
                            </v-layout>
                            <v-layout align-start justify-start row fill-height>
                                <v-checkbox
                                    label="4.0"
                                    color="red"
                                    value="red"
                                    hide-details
                                    class="m-t-0 p-t-0"
                                ></v-checkbox>
                                <v-progress-linear
                                    color="success"
                                    height="15"
                                    value="30"
                                    class="detail-sort-bar"
                                ></v-progress-linear>
                                <div>(30)</div>
                            </v-layout>
                            <v-layout align-start justify-start row fill-height>
                                <v-checkbox
                                    label="3.0"
                                    color="red"
                                    value="red"
                                    hide-details
                                    class="m-t-0 p-t-0"
                                ></v-checkbox>
                                <v-progress-linear
                                    color="success"
                                    height="15"
                                    value="30"
                                    class="detail-sort-bar"
                                ></v-progress-linear>
                                <div>(30)</div>
                            </v-layout>
                            <v-layout align-start justify-start row fill-height>
                                <v-checkbox
                                    label="2.0"
                                    color="red"
                                    value="red"
                                    hide-details
                                    class="m-t-0 p-t-0"
                                ></v-checkbox>
                                <v-progress-linear
                                    color="success"
                                    height="15"
                                    value="30"
                                    class="detail-sort-bar"
                                ></v-progress-linear>
                                <div>(30)</div>
                            </v-layout>
                            <v-layout align-start justify-start row fill-height>
                                <v-checkbox
                                    label="1.0"
                                    color="red"
                                    value="red"
                                    hide-details
                                    class="m-t-0 p-t-0"
                                ></v-checkbox>
                                <v-progress-linear
                                    color="success"
                                    height="15"
                                    value="30"
                                    class="detail-sort-bar"
                                ></v-progress-linear>
                                <div>(30)</div>
                            </v-layout>
                        </v-layout>
                    </v-flex>
                    <v-flex xs12 sm4 md4 class="detail-sort-segment">
                        <h5 class="subheading font-weight-bold">ソート</h5>
                        <v-checkbox
                            label="参考になった順"
                            color="red"
                            value="red"
                            hide-details
                            class="m-t-0 p-t-0"
                        ></v-checkbox>
                        <v-checkbox
                            label="新着順"
                            color="red"
                            value="red"
                            hide-details
                            class="m-t-0 p-t-0"
                        ></v-checkbox>
                    </v-flex>
                    <v-flex xs12 sm4 md4 class="detail-sort-segment">
                        <h5 class="subheading font-weight-bold">その他</h5>
                        <v-checkbox
                            label="写真がある投稿のみ"
                            color="red"
                            value="red"
                            hide-details
                            class="m-t-0 p-t-0"
                        ></v-checkbox>
                    </v-flex>
                </v-layout>

                <v-layout
                        v-for="review in reviews[1]"
                        :key="review.id"
                        align-start
                        justify-space-between
                        row
                        wrap
                        fill-height
                        class="detail-review-review">
                    <v-flex xs12 sm12 md3 class="">
                        <v-layout align-center justify-center column fill-height class="">
                            <v-flex xs12 sm12 md12 lg12><span class="detail-review-totalrate-sub-num" v-text="review.rate_synthesis"></span></v-flex>
                            <v-flex xs12 sm12 md12 lg12>
                                <v-avatar color="grey lighten-4" class="detail-review-author">
                                    <img src="https://cdn.vuetifyjs.com/images/john.jpg" class="detail-review-author-image" alt="avatar">
                                </v-avatar>
                            </v-flex>
                            <v-flex xs12 sm12 md12 lg12 class="">
                                <v-layout align-center justify-center column fill-height class="">
                                    <v-flex xs12 sm12 md12 lg12 class="detail-review-author-name" v-text="review.user[0].username"></v-flex>
                                    <v-flex xs12 sm12 md12 lg12 class="">
                                        <div class="detail-review-author-social">
                                            <v-btn
                                                icon
                                                class="detail-review-author-social-button light-blue--text"
                                                :href="review.user[0].twitter"
                                                target="_blank"
                                                :disabled="review.user[0].twitter == ''">
                                                <v-icon small>fab fa-twitter</v-icon>
                                            </v-btn>
                                            <v-btn
                                                icon
                                                class="detail-review-author-social-button blue--text text--darken-4"
                                                :href="review.user[0].facebook"
                                                target="_blank"
                                                :disabled="review.user[0].facebook == ''">
                                                <v-icon small>fab fa-facebook-f</v-icon>
                                            </v-btn>
                                            <v-btn
                                                icon
                                                class="detail-review-author-social-button red--text"
                                                :href="review.user[0].youtube"
                                                target="_blank"
                                                :disabled="review.user[0].youtube == ''">
                                                <v-icon small>fab fa-youtube</v-icon>
                                            </v-btn>
                                        </div>
                                    </v-flex>
                                </v-layout>
                            </v-flex>
                        </v-layout>
                    </v-flex>
                    <v-flex xs12 sm12 md9 class="detail-review-right">
                        <h4 class="title font-weight-bold detail-review-header-inner" v-text="review.review_title"></h4>
                        <p v-text="review.review_text"></p>
                        <v-flex xs12 sm12 md12>
                            <v-container class="detail-review-gallery" grid-list-sm fluid>
                                <v-layout row wrap>
                                    <v-flex
                                        v-for="(n, i) in review.imglen"
                                        :key="i"
                                        xs3
                                        sm2
                                        d-flex
                                    >
                                        <v-card flat tile class="d-flex">
                                            <v-img
                                                :src="review.imglist[i]"
                                                :lazy-src="review.imglist[i]"
                                                aspect-ratio="1"
                                                class="grey lighten-2"
                                                @click="review.dialog = true"
                                            >
                                                <v-layout
                                                    slot="placeholder"
                                                    fill-height
                                                    align-center
                                                    justify-center
                                                    ma-0
                                                >
                                                    <v-progress-circular indeterminate color="grey lighten-5"></v-progress-circular>
                                                </v-layout>
                                            </v-img>
                                        </v-card>
                                    </v-flex>

                                    <v-dialog
                                        v-model="review.dialog"
                                        max-width="800"
                                    >
                                        <v-carousel hide-delimiters class="detail-review-gallery-dialog">
                                            <v-carousel-item
                                                v-for="(n, i) in review.imglen"
                                                :key="i"
                                                :src="review.imglist[i]"
                                                contain
                                                dark
                                            ></v-carousel-item>
                                        </v-carousel>
                                    </v-dialog>

                              </v-layout>
                            </v-container>
                        </v-flex>
                        <v-layout align-start justify-space-between row fill-height>
                            <div>投稿日:<span class="" v-text="review.review_date"></span></div>
                            <v-btn outline color="indigo" class="m-t-0 m-r-0 m-b-0 m-l-0">参考になった</v-btn>
                        </v-layout>
                    </v-flex>
                </v-layout>


            </v-container>
        </v-flex>
    </v-layout>
{% endblock %}

{% block javascript %}
    <script src="{% static 'js/skill.bars.jquery.js' %}"></script>
    <script src="{% static 'js/circle-progress.min.js' %}"></script>
    <script>
        $(window).on('load', function(){
            var param_value = app.reviews[{{ request.path|slice:'-2:-1' }}].length;
            var total_value = 0;
            var circle_value = 0;
            for(var i=0; i<param_value; i++){
                total_value += app.reviews[{{ request.path|slice:'-2:-1' }}][i]['rate_synthesis'];
            }

            if(!(param_value == 0 && total_value == 0)){
                circle_value = ((total_value/param_value).toFixed(1) / 5.0).toFixed(1);
            }

            $('.detail-rate-review-count-num').text(param_value);

            $('.skillbar').skillBars({
                from: 0,
                speed: 2000,
                interval: 100,
            });

            $('.circle').circleProgress({
                value: circle_value,
                size: 120,
                startAngle:Math.PI / -2,
                fill: {
                    gradient: ["red", "orange"]
                }
            }).on('circle-animation-progress', function(event, progress, stepValue) {
                $(this).find('strong').html((total_value/param_value).toFixed(1));
            });

        });
    </script>
{% endblock %}